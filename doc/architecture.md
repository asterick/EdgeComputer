Architecture
============

The EdgeCPU is designed to be very memory intensive, while reducing the size of the instruction word
without compromizing on speed or ability.  To get around this, the machine is signed with a large
number of semi-ortho registers (in abundance) organized in 16x8 register files.  Additionally, there
is a general purpose ALU, as well as a simple incrementer used for address modifications.

The bulk of the machine's complexity comes from the use of a TLB for memory management, which may
eventually be moved to a CPLD for the sake of performance.

Currently, the external hardware is unmapped as I've not decided how I want to handle removable media.
3.5" floppy is very likely going to be the direction taken for this, but will require a controller.

Specs
-----

* 8k x 48 microcode storage
* 24x8 memory interface
* dual ALU: 16-bit general, 24-bit incrementer (address)
* Memory management - 16-index TLB (4k pages)
* 8 General Purpose registers (16bit, one allocated for scratch)
* 8 Addressing registers (32bit)

Status word
-----------

The status word is internally organized as loose bits on their respective cards, but when accessed as
a word, the individual bits are organized as this

 Bits | Field
----- | ----------
15:12 | Program id
    9 | Supervisor flag
    8 | TLB enabled
    4 | Interrupts Enabled
    3 | Negative flag
    2 | Overflow flag
    1 | Zero flag
    0 | Carry flag

Fault code format
-----------------

The fault code is generated by the IRQ circuit.  As a rule the interrupt circuit will not fire until a branch
to code from register occurs.  To help smooth out memory faults, the TLB errors will simply create an unmaskable
interrupt while masking out access to unmapped memory.  It is recommended that in the microcode you always use
the same register numbers for state branches to make failures easier to manage.

Privileged instruction faults are considered unrecoverable and will throw an exception immediately.

 Bits | Field
----- | ---------------------------------
15:12 | Address Register (TLB fault only)
 11:2 | Vector index
  1:0 | Zero (pre multiplied vector)

TLB Registers (write-only)
--------------------------

Index |  Name | Bits | Description 
----- | ----- | ---- | ------------------
    1 | Index |  3:0 | Entry select for write
    2 | Bank  | 15:4 | Virtual address (upper)
      |       |  3:0 | Bank PID
    3 | Flags | 15:4 | Physical address
      |       |    2 | Entry valid (must be 1)
      |       |    1 | Read allowed
      |       |    0 | Write allowed

TLB active when:  (addr[23:12] == bank[15:4]) && (pid == bank[3:0]) && (flags[2]) && (!RD || flags[1]) && (!WR || flags[0])
Physical address: { flags[15:4], addr[11:0]  }

Memory map
----------

              Range |     Type | Description
------------------- | -------- | -------------------
0x000000 ~ 0x07FFFF |     BIOS | Socketed Flash
0x080000 ~ 0x0FFFFF | Hardware | 512kB worth of hardware space
0x100000 ~ 0x3F0000 |      RAM | Hardwired SRAM
0x400000 ~ 0xFFFFFF |     DRAM | 3x 30-pin simm


Register map (External hardware)
--------------------------------

This is where I will be mapping all the external hardware.  
The current VLSI roadmap contains the following ICs. 

I will eventually decide on a chip for RTC and maybe keyboard/mouse if the UART cannot be used.

* V9938 Video (192k DRAM)
	* 4 bytes mapped
* YM3812 OPL2 audio
	* 2 bytes mapped
* Super I/O
	* IDE, UART, Parallel port and Floppy controller
	* 2048 bytes mapped
